<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<TITLE>
サイトツリー
</TITLE>
</HEAD>
<BODY>
<H1>サイトツリー</H1>
<p>
サイトツリーは、アクセスしたサイトをZAPが内部的に表現したもので、<a href="../../ui/tabs/sites.html">サイトタブ</a>に表示されます。
サイトを正確に反映していない場合、ZAPはそれらのサイトを効果的に攻撃できません。
ツリー内の各ノードは、サイト内の異なる機能を表します。 
デフォルトでは、ZAPはHTTPメソッドとパラメーター名に基づいて、ツリー内に一意のノードを作成します。
</p>
<p>
これは、以下のリクエストがすべて異なるツリーノードを持つことを意味します：
<ul>
<li>GET https://www.example.com/ex1?a=b&amp;c=d</li>
<li>GET https://www.example.com/ex1?a=b&amp;d=c</li>
<li>POST https://www.example.com/ex1?a=b&amp;c=d</li>
</ul>

そして、以下のリクエストは同じノードを持つことになります：
<ul>
<li>GET https://www.example.com?a=b&amp;c=d</li>
<li>GET https://www.example.com?a=c&amp;c=c</li>
<li>GET https://www.example.com?a=e&amp;c=f</li>
</ul>

これは多くの場合うまく機能します - 異なるHTTPメソッドとパラメーター名は通常異なるアクションを意味し、パラメーター値は通常結果を変更しません。

<H2>例外</H2>

常に例外があります。

<H3>構造パラメーター</H3>

実行されるアクションがパラメーター値で実際に定義されているケースを考えてみましょう：
<ul>
<li>GET https://www.example.com?a=b&amp;action=add</li>
<li>GET https://www.example.com?a=b&amp;action=delete</li>
</ul>

この場合、両方のURLは同じサイトツリーノードになり、実際にはそのうちの1つだけが攻撃されます。 
もう一方のURLは攻撃されないため、そのアクションに特有の脆弱性は発見されません。
<p>
ZAPでは、'action' パラメーターを<a href="structparams.html">構造パラメーター</a>として定義することで、この問題を解決できます。構造パラメーターとは、その値がサイトの構造に実際に影響を与えるパラメーターのことです。 
これを実行すると (そしてURLを再訪問すると)、2つの異なるノードとして表示され、ZAPはそれらを個別に攻撃します。

<H3>データ駆動型ノード</H3>

逆に、URLパス要素が実際にはデータの一部であり、サイトの構造の一部ではない場合があります。 
例えば、2番目のパス要素 (companyX) が実際にはデータである場合、以下のURLはすべて同じ機能を表す可能性があります：

<ul>
<li>https://www.example.com/app/company1/aaa?ddd=eee</li>
<li>https://www.example.com/app/company2/aaa?ddd=fff</li>
<li>https://www.example.com/app/company3/aaa?ddd=ggg</li>
</ul>

この場合、3つのURLすべてが一意のノードになり、ZAPはそれぞれを攻撃しますが、実際には攻撃する必要はありません。 
インスタンスが3件程度であれば大きな問題にはなりませんが、ほとんどの場合このデータはデータベースから取得されるため、同様のノードが非常に多くなる可能性があります。
<p>
この解決策は、関連するパス要素を<a href="ddc.html">データ駆動型コンテンツ</a>として定義することです。これは、サイト構造の一部を表すのではなく、実際にデータを含むパス要素を意味します。 
これを実行すると (そしてURLを再訪問すると)、すべてが1つのノードとして表現され、ZAPは1回だけ攻撃します。
<p>
構造パラメーターとデータ駆動型ノードの両方を手動で定義する必要があります - ZAPには現在、これらの状況を自動的に検出する機能はありません。

<H3>カスタムパラメーター</H3>

最後に、ZAPがネイティブに理解できないカスタムパラメーターをサイトが定義している場合があります。 
その結果、ZAPはリクエストを適切なノードに正しく分割できない可能性があります。
<p>
これらの場合、入力ベクトル<a href="scripts.html">スクリプト</a>を使用できます。これにより、サイトツリー内のリクエストを任意の方法で表現できます。

<h2>Node Name Format</h2>

<h3>Top Level Nodes</h3>
The top level node names include the protocol, host name and the port (if specified), e.g. <code>https://www.example.com:8080</code>

<h3>Intermediate Nodes</h3>
Non leaf nodes will just have the name of the relevant part of the URL path, unless they are configured to be 
<a href="ddc.html">Data Driven Content</a> in which case then will have the format <code>«ddc-name»</code>.

<h3>Leaf Nodes</h3>
Leaf node names are made up of:
<ul>
<li>The HTTP method (GET, POST, etc)
<li>A colon
<li>The last path element, or "/" if the last element is empty
<li>A list of the URL parameter names in round brackets
<li>An optional representation of the POST parameter names in round brackets
</ul>

A GET request to 
<ul>
<li><code>https://www.example.com/aaa/bbb?cc=dd&amp;ee=ff</code>
</ul>
will be represented as 3 nodes:
<ul>
<li>https://www.example.com
  <ul>
  <li>aaa
    <ul>
    <li>GET:bbb(cc,ee)
    </ul>
  </ul>
</ul>

A POST request to 
<ul>
<li><code>https://www.example.com/aaa/bbb/ccc/?cc=dd</code>
</ul>
 with "application/x-www-form-urlencoded" encoded data
<ul>
<li><code>cc=dd&amp;ee=ff&amp;gg=hh</code>
</ul>

will be represented as 5 nodes:
<ul>
<li>https://www.example.com
  <ul>
  <li>aaa
    <ul>
    <li>bbb
      <ul>
      <li>ccc
        <ul>
        <li>POST:/(cc)(cc,ee,gg)
        </ul>
      </ul>
    </ul>
  </ul>
</ul>

A POST request to 
<ul>
<li><code>https://www.example.com/aaa/bbb/ccc</code>
</ul>
with the JSON encoded data
<ul>
<li><code>{"aaa":{"bbb": "ccc", "ddd": "eee"}, fff: ["kkk", {"ggg":"hhh"}, {"iii":"jjj"}]}</code>
</ul>
will be represented as 4 nodes:
<ul>
<li>https://www.example.com
  <ul>
  <li>aaa
    <ul>
    <li>bbb
      <ul>
      <li>POST:ccc()({aaa:{bbb,ddd},fff:[{ggg},{iii}]})
      </ul>
    </ul>
  </ul>
</ul>

A POST request to 
<ul>
<li><code>https://www.example.com/aaa/bbb/</code>
</ul>
with the XML encoded data
<ul>
<li><code>&lt;aaa&gt;&lt;bbb&gt;BBB&lt;/bbb&gt;&lt;ccc&gt;CCC&lt;/ccc&gt;&lt;ddd&gt;DDD&lt;/ddd&gt;&lt;/aaa&gt;</code>
</ul>
will be represented as 4 nodes:
<ul>
<li>https://www.example.com
  <ul>
  <li>aaa
    <ul>
    <li>bbb
      <ul>
      <li>POST:/()(&lt;aaa:&lt;bbb&gt;,&lt;ccc&gt;,&lt;ddd&gt;&gt;)
      </ul>
    </ul>
  </ul>
</ul>

For JSON and XML data repeated child elements may be represented using "<code>..</code>".<br>
For example <ul>
<li><code>[{"a":{"b": "c", "d": "e"}},{"a":{"b": "f", "d": "g"}},{"a":{"b": "h", "d": "i"}}]</code>
</ul>
will be represented as 
<ul>
<li><code>[{a:{b,d}}..]</code>
</ul>
<p>
A POST request to 
<ul>
<li><code>https://www.example.com/aaa/</code>
</ul>
with multipart POST data like:
<pre>
-----------------------------3973496743964376987349857345
Content-Disposition: form-data; name="text"

text default
-----------------------------3973496743964376987349857345
Content-Disposition: form-data; name="file1"; filename="a.txt"
Content-Type: text/plain

Content of a.txt.

-----------------------------3973496743964376987349857345
Content-Disposition: form-data; name="file2"; filename="a.html"
Content-Type: text/html

&lt;!DOCTYPE html&gt;&lt;title&gt;Content of a.html.&lt;/title&gt;

-----------------------------3973496743964376987349857345--
</pre>

will be represented as 3 nodes:
<ul>
<li>https://www.example.com
  <ul>
  <li>aaa
    <ul>
    <li>POST:/()(multipart:text,file1,file2)
    </ul>
  </ul>
</ul>

<H2>関連情報</H2>
<table>
<tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td>
<a href="../../ui/overview.html">UIの概要</a></td><td>ユーザーインターフェースの概要について</td></tr>
<tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td>
<a href="features.html">機能</a></td><td>ZAPが提供する機能について</td></tr>
</table>

<H2>外部リンク</H2>
<table>
<tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><a href="https://www.zaproxy.org/blog/2020-09-22-sites-tree-modifiers/">ZAP Blog: Sites Tree Modifiers</a></td></tr>
</table>

</BODY>
</HTML>
